PROJECT(qSlicerBaseQTGUIPlugin)
INCLUDE_DIRECTORIES(  
  ${QT_INCLUDE_DIR}
  ${QT_QTGUI_INCLUDE_DIR}
  ${QT_QTCORE_INCLUDE_DIR}
  ${QT_QTDESIGNER_INCLUDE_DIR}
  ${CMAKE_CURRENT_BINARY_DIR}
)

# Create the plugin for Qt Designer
SET(qSlicerQTGUIPlugin_SRCS
  qSlicerQTGUIAbstractPlugin.h
  qSlicerQTGUIAbstractPlugin.cxx
  qSlicerQTGUIPlugins.h
  qSlicerQTGUIPlugins.cxx
  qSlicerWidgetPlugin.h
  qSlicerWidgetPlugin.cxx
  )

SET(qSlicerQTGUIPlugin_MOC_SRCS
  qSlicerQTGUIPlugins.h
  )

QT4_WRAP_CPP(qSlicerQTGUIPlugin_SRCS ${qSlicerQTGUIPlugin_MOC_SRCS})
#SET (CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin/designer)
#SET (CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin/designer)
#SET (CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin/designer)

CONFIGURE_FILE(
  ${CMAKE_CURRENT_SOURCE_DIR}/qSlicerQTGUIPluginConfigure.h.in 
  ${CMAKE_CURRENT_BINARY_DIR}/qSlicerQTGUIPluginConfigure.h
  )

FILE(GLOB files "${CMAKE_CURRENT_SOURCE_DIR}/*.h") 
INSTALL(FILES 
  ${files}
  ${CMAKE_CURRENT_BINARY_DIR}/qSlicerQTGUIPluginConfigure.h
  DESTINATION ${Slicer3_INSTALL_INCLUDE_DIR}/${PROJECT_NAME} COMPONENT Development
  )

SET(lib_name "qSlicerBaseQTGUIPlugin")

ADD_LIBRARY(${lib_name} SHARED ${qSlicerQTGUIPlugin_SRCS})
SET_TARGET_PROPERTIES(${lib_name}  PROPERTIES 
                      COMPILE_FLAGS "-DQT_PLUGIN -DQT_NO_DEBUG")

TARGET_LINK_LIBRARIES(${lib_name} 
  ${QT_QTCORE_LIBRARY}
  ${QT_QTGUI_LIBRARY}
  ${QT_QTDESIGNER_LIBRARY}
  qSlicerBaseQTBase
  #qSlicerBaseQTCLI
  qSlicerBaseQTGUI
  )
  

GET_TARGET_PROPERTY(FILE_PATH ${PROJECT_NAME} LOCATION)
GET_TARGET_PROPERTY(DIR_PATH ${PROJECT_NAME} LIBRARY_OUTPUT_DIRECTORY)
GET_FILENAME_COMPONENT(LIB_NAME ${PROJECT_NAME} NAME)

IF(WIN32)
  ADD_CUSTOM_COMMAND(
    TARGET ${PROJECT_NAME}
    POST_BUILD
    #COMMAND ${CMAKE_COMMAND} -E copy ${FILE_PATH} ${CMAKE_BINARY_DIR}/bin/designer/
    COMMAND ${CMAKE_COMMAND} -E copy ${FILE_PATH} ${DIR_PATH}/${CMAKE_CFG_INTDIR}/designer/${CMAKE_SHARED_LIBRARY_PREFIX}${LIB_NAME}${CMAKE_SHARED_LIBRARY_SUFFIX}
    )
ELSE(WIN32)
  ADD_CUSTOM_COMMAND(
    TARGET ${PROJECT_NAME}
    POST_BUILD
#    COMMAND ${CMAKE_COMMAND} -E create_symlink ${FILE_PATH} ${CMAKE_BINARY_DIR}/bin/designer/${CMAKE_SHARED_LIBRARY_PREFIX}${LIB_NAME}${CMAKE_SHARED_LIBRARY_SUFFIX}
    COMMAND ${CMAKE_COMMAND} -E create_symlink ${FILE_PATH} ${DIR_PATH}/designer/${CMAKE_SHARED_LIBRARY_PREFIX}${LIB_NAME}${CMAKE_SHARED_LIBRARY_SUFFIX}
    )  
ENDIF(WIN32)

# --------------------------------------------------------------------------
# Install the library

INSTALL(TARGETS ${lib_name}
  RUNTIME DESTINATION ${Slicer3_INSTALL_BIN_DIR} COMPONENT RuntimeLibraries 
  LIBRARY DESTINATION ${Slicer3_INSTALL_LIB_DIR} COMPONENT RuntimeLibraries
  ARCHIVE DESTINATION ${Slicer3_INSTALL_LIB_DIR} COMPONENT Development
  )
